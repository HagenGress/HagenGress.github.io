{% assign media_paths = include.images | split: ", " %}
{% assign media_captions = include.captions | split: "||" %}
{% assign gallery_width = include.width | default: "300" %}

<style>
  .media-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 2rem;
    width: 100%;
    margin-bottom: 2rem;
  }
  .media-item {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    text-align: left;
  }
  .media-caption {
    margin-bottom: 0.5rem;
    font-weight: bold;
  }
</style>

<div class="media-grid">
  {% assign index = 0 %}
  {% for media_path in media_paths %}
    {% assign media_name = media_path | strip %}
    {% assign caption = media_captions[index] | default: "Figure " | append: index | plus: 1 %}
    {% assign extension = media_name | split: '.' | last | downcase %}

    {% if media_name contains 'https://' %}
      {% assign full_path = media_name %}
    {% else %}
      {% assign page_url_without_index = page.url | remove: 'index' | remove: '.html' %}
      {% assign full_path = page_url_without_index | append: media_name %}
    {% endif %}

    <div class="media-item">
      <div class="media-caption">{{ caption }}</div>

      {% if extension == "mp4" %}
        <video 
          src="{{ full_path }}" 
          controls 
          muted 
          playsinline 
          style="width: {{ gallery_width }}px;"
        ></video>

      {% else %}
        <img 
          src="{{ full_path }}" 
          alt="{{ media_name }}" 
          loading="lazy" 
          style="width: {{ gallery_width }}px;"
          onerror="this.onerror=null;this.src=this.src.replace('.webp','.png').replace('.png','.webp');"
        />
      {% endif %}
    </div>

    {% assign index = index | plus: 1 %}
  {% endfor %}
</div>
