{% assign raw_items = include.images | strip %}
{% assign raw_items = raw_items | replace: "},", "}||" %}
{% assign raw_items = raw_items | remove: "[" | remove: "]" %}
{% assign raw_list = raw_items | split: "||" %}
{% assign gallery_width = include.width | default: "300" %}

<style>
  .media-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 2rem;
    width: 100%;
    margin-bottom: 2rem;
  }
  .media-item {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    text-align: left;
  }
  .media-caption {
    margin-bottom: 0.5rem;
    font-weight: bold;
  }
</style>

<div class="media-grid">
  {% for item_string in raw_list %}
    {% assign item_string = item_string | replace: "'", '"' %}
    {% assign path = item_string | split: ',"caption":' | first | replace: '{"path": "', '' | replace: '"', '' %}
    {% assign caption = item_string | split: ',"caption":' | last | remove: '}' | remove: '"' %}
    {% assign extension = path | split: '.' | last | downcase %}

    {% if path contains 'https://' %}
      {% assign full_path = path %}
    {% else %}
      {% assign page_url_without_index = page.url | remove: 'index' | remove: '.html' %}
      {% assign full_path = page_url_without_index | append: path %}
    {% endif %}

    <div class="media-item">
      <div class="media-caption">{{ caption }}</div>

      {% if extension == "mp4" %}
        <video 
          src="{{ full_path }}" 
          controls 
          muted 
          playsinline 
          style="width: {{ gallery_width }}px;"
        ></video>
      {% else %}
        <img 
          src="{{ full_path }}" 
          alt="{{ path }}" 
          loading="lazy" 
          style="width: {{ gallery_width }}px;"
          onerror="this.onerror=null;this.src=this.src.replace('.webp','.png').replace('.png','.webp');"
        />
      {% endif %}
    </div>
  {% endfor %}
</div>
